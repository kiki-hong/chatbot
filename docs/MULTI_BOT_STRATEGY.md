# FRP (Functional Requirements & Plan): 멀티 챗봇 데이터 분리 전략

## 1. 개요
본 문서는 하나의 플랫폼에서 여러 챗봇(한의학, 사주, 지식산업센터 등)을 운영할 때, 각 챗봇의 **지식 데이터(Knowledge Data)를 어떻게 분리하고 관리할 것인가**에 대한 기술적 전략과 계획을 기술합니다.

## 2. 데이터 분리 아키텍처

### 2.1 논리적 분리 (Logical Separation)
모든 데이터 파일은 물리적으로 같은 `data/` 폴더에 존재할 수 있지만, **설정 파일(`lib/bots.ts`)**을 통해 논리적으로 엄격하게 분리됩니다.

*   **설정 예시 (`lib/bots.ts`)**:
    ```typescript
    'oriental': {
        // ...
        rag: {
            coreFiles: ['한의학역사.md'], // 한의학 봇은 이 파일만 봅니다.
            keywordMap: { ... }
        }
    },
    'saju': {
        // ...
        rag: {
            coreFiles: ['명리심리상담.md'], // 사주 봇은 이 파일만 봅니다.
            keywordMap: { ... }
        }
    }
    ```

### 2.2 런타임 분리 (Runtime Enforcement)
사용자가 질문을 던지는 순간, 시스템은 다음 절차를 통해 데이터 혼용을 원천 차단합니다.

1.  **요청 식별**: 사용자가 접속한 URL(`?bot=saju`)을 통해 `sourceId`를 식별합니다.
2.  **설정 로드**: `sourceId`에 해당하는 설정(`BotConfig`)만 메모리에 로드합니다.
3.  **RAG 필터링**: `lib/rag.ts`의 `getContext` 함수는 오직 로드된 설정에 정의된 파일(`coreFiles`)만 읽어옵니다. 다른 봇의 파일은 아예 읽지 않습니다.

## 3. 데이터 관리 프로세스

### 3.1 파일 명명 규칙 (Naming Convention)
데이터 파일의 혼동을 막기 위해 접두어를 사용하는 것을 권장합니다.
*   한의학 관련: `oriental_역사.md`, `oriental_체질.md`
*   사주 관련: `saju_기초.md`, `saju_심리.md`
*   지식산업센터 관련: `jisan_세법.md`

### 3.2 확장성 계획 (Vector DB 도입 시)
향후 데이터가 많아져 벡터 데이터베이스(Pinecone 등)를 도입할 경우, **메타데이터 필터링**을 사용합니다.
*   데이터 저장 시: `{"content": "...", "metadata": {"botId": "saju"}}` 형태로 저장.
*   데이터 검색 시: `filter: { botId: "saju" }` 조건을 추가하여 해당 봇의 데이터만 검색.

## 4. 결론
현재 구현된 시스템은 **설정 기반의 화이트리스트(Allowlist) 방식**을 사용하여, 챗봇이 자신에게 허용된 파일 외에는 접근할 수 없도록 설계되어 있습니다. 따라서 한의학 봇이 사주 데이터를 답변하거나 그 반대의 경우는 발생하지 않습니다.
